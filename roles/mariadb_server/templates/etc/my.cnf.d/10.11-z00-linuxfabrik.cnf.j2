# {{ ansible_managed }}
# 2024091101
# 10.11

# https://mariadb.com/kb/en/library/server-system-variables/

[server]
bulk_insert_buffer_size                        = {{ mariadb_server__cnf_bulk_insert_buffer_size__combined_var | d(8388608) }}
character_set_server                           = {{ mariadb_server__cnf_character_set_server__combined_var | d('latin1') }}
collation_server                               = {{ mariadb_server__cnf_collation_server__combined_var | d('latin1_swedish_ci') }}
expire_logs_days                               = {{ mariadb_server__cnf_expire_logs_days__combined_var | d(0.000000) }}
innodb_buffer_pool_size                        = {{ mariadb_server__cnf_innodb_buffer_pool_size__combined_var | d('128M') }}
innodb_file_per_table                          = {{ mariadb_server__cnf_innodb_file_per_table__combined_var | d('ON') }}
innodb_flush_log_at_trx_commit                 = {{ mariadb_server__cnf_innodb_flush_log_at_trx_commit__combined_var | d(1) }}
innodb_io_capacity                             = {{ mariadb_server__cnf_innodb_io_capacity__combined_var | d(200) }}
innodb_log_file_size                           = {{ mariadb_server__cnf_innodb_log_file_size__combined_var | d('96M') }}
interactive_timeout                            = {{ mariadb_server__cnf_interactive_timeout__combined_var | d(28800) }}
join_buffer_size                               = {{ mariadb_server__cnf_join_buffer_size__combined_var | d('256K') }}
log_error                                      = {{ mariadb_server__cnf_log_error__combined_var | d('') }}
lower_case_table_names                         = {{ mariadb_server__cnf_lower_case_table_names__combined_var | d(0) }}
max_allowed_packet                             = {{ mariadb_server__cnf_max_allowed_packet__combined_var | d('16M') }}
max_connections                                = {{ mariadb_server__cnf_max_connections__combined_var | d(151) }}
max_heap_table_size                            = {{ mariadb_server__cnf_max_heap_table_size__combined_var | d('16M') }}
performance_schema                             = {{ mariadb_server__cnf_performance_schema__combined_var | d('OFF') }}
query_cache_limit                              = {{ mariadb_server__cnf_query_cache_limit__combined_var | d('1M') }}
query_cache_size                               = {{ mariadb_server__cnf_query_cache_size__combined_var | d('1M') }}
query_cache_type                               = {{ mariadb_server__cnf_query_cache_type__combined_var | d('OFF') }}
skip_name_resolve                              = {{ mariadb_server__cnf_skip_name_resolve__combined_var | d('OFF') }}
slow_query_log                                 = {{ mariadb_server__cnf_slow_query_log__combined_var | d('OFF') }}
slow_query_log_file                            = {{ mariadb_server__cnf_slow_query_log_file__combined_var | d('localhost-slow.log') }}
sql_mode                                       = {{ mariadb_server__cnf_sql_mode__combined_var | d('STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION') }}
table_definition_cache                         = {{ mariadb_server__cnf_table_definition_cache__combined_var | d(400) }}
tmp_table_size                                 = {{ mariadb_server__cnf_tmp_table_size__combined_var | d('16M') }}
wait_timeout                                   = {{ mariadb_server__cnf_wait_timeout__combined_var | d(28800) }}

{% if mariadb_server__dare_keys is defined and mariadb_server__dare_keys %}
# File Key Management
plugin_load_add                                = {{ mariadb_server__cnf_plugin_load_add__combined_var | d('file_key_management') }}
loose_file_key_management_filename             = {{ mariadb_server__cnf_file_key_management_filename__combined_var | d('/etc/my.cnf.d/keyfile') }}
loose_file_key_management_encryption_algorithm = {{ mariadb_server__cnf_file_key_management_encryption_algorithm__combined_var | d('AES_CTR') }}

# Basic Encryption Configuration
encrypt_binlog                                 = {{ mariadb_server__cnf_encrypt_binlog__combined_var | d('ON') }}
encrypt_tmp_files                              = {{ mariadb_server__cnf_encrypt_tmp_files__combined_var | d('ON') }}

# InnoDB Encryption
innodb_default_encryption_key_id               = {{ mariadb_server__cnf_innodb_default_encryption_key_id__combined_var | d('1') }}
innodb_encrypt_log                             = {{ mariadb_server__cnf_innodb_encrypt_log__combined_var | d('ON') }}
innodb_encrypt_tables                          = {{ mariadb_server__cnf_innodb_encrypt_tables__combined_var | d('ON') }}
innodb_encrypt_temporary_tables                = {{ mariadb_server__cnf_innodb_encrypt_temporary_tables__combined_var | d('ON') }}
innodb_encryption_rotate_key_age               = {{ mariadb_server__cnf_innodb_encryption_rotate_key_age__combined_var | d('1') }}
innodb_encryption_threads                      = {{ mariadb_server__cnf_innodb_encryption_threads__combined_var | d('4') }}
{% endif %}


[mysqld]

[galera]

[embedded]

[mariadb]

[mariadb-10.0]

[mariadb-10.1]

[mariadb-10.2]

[mariadb-10.3]

[mariadb-10.4]

[mariadb-10.5]

[mariadb-10.6]

[mariadb-10.11]
