# {{ ansible_managed }}
# 2022042101

# https://mariadb.com/kb/en/library/server-system-variables/

[server]
character_set_server           = {{ mariadb_server__10_6_character_set_server | default('latin1') }}
collation_server               = {{ mariadb_server__10_6_collation_server | default('latin1_swedish_ci') }}
expire_logs_days               = {{ mariadb_server__10_6_expire_logs_days | default('0') }}
innodb_file_per_table          = {{ mariadb_server__10_6_innodb_file_per_table | default('ON') }}
innodb_io_capacity             = {{ mariadb_server__10_6_innodb_io_capacity | default('200') }}
join_buffer_size               = {{ mariadb_server__10_6_join_buffer_size | default('262144') }}
max_allowed_packet             = {{ mariadb_server__10_6_max_allowed_packet | default('16777216') }}
max_connections                = {{ mariadb_server__10_6_max_connections | default('151') }}
max_heap_table_size            = {{ mariadb_server__10_6_max_heap_table_size | default('16777216') }}
performance_schema             = {{ mariadb_server__10_6_performance_schema | default('OFF') }}
query_cache_limit              = {{ mariadb_server__10_6_query_cache_limit | default('1048576') }}
query_cache_size               = {{ mariadb_server__10_6_query_cache_size | default('1048576') }}
query_cache_type               = {{ mariadb_server__10_6_query_cache_type | default('OFF') }}
skip_name_resolve              = {{ mariadb_server__10_6_skip_name_resolve | default('OFF') }}
tmp_table_size                 = {{ mariadb_server__10_6_tmp_table_size | default('16777216') }}
innodb_flush_log_at_trx_commit = {{ mariadb_server__10_6_innodb_flush_log_at_trx_commit | default('1') }}
lower_case_table_names         = {{ mariadb_server__10_6_lower_case_table_names | default('0') }}

{% if mariadb_server__only is defined and mariadb_server__only | bool %}
# calculated for dedicated mariadb server
# assumes 4M per connection (real: 3.7M)
{% if ansible_facts['memtotal_mb'] < 4000 %}
# ram < 4 gb
innodb_buffer_pool_size        = {{ ((ansible_facts['memtotal_mb'] - (mariadb_server__10_6_max_connections | int) * 4) * 0.6) | int }}M
innodb_log_file_size           = {{ ((ansible_facts['memtotal_mb'] - (mariadb_server__10_6_max_connections | int) * 4) / 4 * 0.6) | int }}M
{% else %}
# ram >= 4 gb
innodb_buffer_pool_size        = {{ ((ansible_facts['memtotal_mb'] - (mariadb_server__10_6_max_connections | int) * 4) * 0.8) | int }}M
innodb_log_file_size           = {{ ((ansible_facts['memtotal_mb'] - (mariadb_server__10_6_max_connections | int) * 4) / 4 * 0.8) | int }}M
{% endif %}
{% else %}
# calculated for mariadb on an application server
innodb_buffer_pool_size        = {{ ((ansible_facts['memtotal_mb'] - (mariadb_server__10_6_max_connections | int) * 4) * 0.33) | int }}M
innodb_log_file_size           = {{ ((ansible_facts['memtotal_mb'] - (mariadb_server__10_6_max_connections | int) * 4) / 4 * 0.33) | int }}M
{% endif %}


[mysqld]

[galera]

[embedded]

[mariadb]

[mariadb-10.0]

[mariadb-10.1]

[mariadb-10.2]

[mariadb-10.3]

[mariadb-10.4]

[mariadb-10.5]

[mariadb-10.6]
